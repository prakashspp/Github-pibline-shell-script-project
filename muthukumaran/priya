
stage(" Maven Unit Test") {  
            steps{
                dir ("/var/lib/jenkins/workspace/pipeline"){
                  sh 'mvn test'        
                }
            }
        }
        stage(" Maven Build") {
            steps{
                dir ("/var/lib/jenkins/workspace/pipeline"){
                  sh 'mvn clean install'   
                }
            }
        }
        stage("5. Maven Integration Test") {
            steps{
                dir ("/var/lib/jenkins/workspace/pipeline"){
                  sh 'mvn verify'          
                }
            }
        }






2.


stage ("Build"){
            steps {
                echo "Build the image"
                sh "docker build -t ci-pipeline ."
            }
        }

3.

stage('Deploy to Kubernets'){
             steps{
                 script{
                     dir('/var/lib/jenkins/workspace/pipeline') {
                         withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'kubernetes', namespace: '', restrictKubeConfigAccess: false, serverUrl: '') {
                         sh 'kubectl delete --all pods'
                         sh 'kubectl apply -f deployment.yaml'
                         sh 'kubectl apply -f service.yaml'
                         }
                     }
                 }
             }
         }
